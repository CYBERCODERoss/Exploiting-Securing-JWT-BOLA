# E-commerce Security Demo Project

This project demonstrates common security vulnerabilities in e-commerce applications, specifically focusing on JWT (JSON Web Token) and BOLA (Broken Object Level Authorization) vulnerabilities, along with their secure implementations.

## Security Vulnerabilities Overview

### JWT (JSON Web Token) Vulnerabilities

1. **Weak Secret Keys**
   - Using predictable or simple secret keys
   - Hardcoding secrets in the code
   - Using the same key for extended periods

2. **Token Manipulation**
   - Modifying payload data
   - Changing user roles or permissions
   - Token replay attacks

3. **Token Lifetime Issues**
   - Long expiration times
   - No token refresh mechanism
   - Missing token invalidation

4. **Missing Claims**
   - No token identifier (jti)
   - Missing timestamp claims (iat, nbf)
   - Insufficient payload validation

### BOLA (Broken Object Level Authorization) Vulnerabilities

1. **Insufficient Access Controls**
   - Missing user ownership checks
   - Weak authorization logic
   - Relying only on client-side validation

2. **ID Manipulation**
   - Direct object references
   - Predictable resource IDs
   - Missing resource ownership validation

3. **Horizontal Privilege Escalation**
   - Accessing other users' data
   - Bypassing user context
   - Missing role-based checks

4. **Vertical Privilege Escalation**
   - Accessing admin functions
   - Missing role validation
   - Insufficient permission checks

## Project Implementation

### Vulnerable API Implementation

1. **JWT Vulnerabilities**
   - Static, weak secret key: `very_weak_secret_key_123`
   - Long token expiration (24 hours)
   - Basic token payload without additional security claims
   - Minimal token validation

2. **BOLA Vulnerabilities**
   - No user ownership validation in order endpoints
   - Direct object reference using IDs
   - Missing role-based access control
   - Weak authorization checks

### Secure API Implementation

1. **JWT Security Measures**
   - Strong, random secret key
   - Short token expiration (30 minutes)
   - Additional security claims:
     - Token ID (jti)
     - Issued At (iat)
     - Not Before (nbf)
   - Comprehensive token validation

2. **BOLA Security Measures**
   - User ownership validation
   - Role-based access control
   - Strict authorization checks
   - Resource isolation between users

## Project Setup

### Prerequisites
- Node.js (v14 or higher)
- MongoDB
- Postman

### Installation

1. Clone the repository:
   \`\`\`bash
   git clone <repository-url>
   cd e-commerce-security-demo
   \`\`\`

2. Install dependencies:
   \`\`\`bash
   npm install
   \`\`\`

3. Create .env file:
   \`\`\`env
   PORT=3000
   MONGODB_URI_VULNERABLE=mongodb://localhost:27017/ecommerce_vulnerable
   MONGODB_URI_SECURE=mongodb://localhost:27017/ecommerce_secure
   JWT_VULNERABLE_SECRET=very_weak_secret_key_123
   JWT_SECURE_SECRET=a_very_long_and_secure_random_key_that_should_be_kept_secret
   JWT_VULNERABLE_EXPIRY=1d
   JWT_SECURE_EXPIRY=30m
   \`\`\`

4. Start MongoDB:
   \`\`\`bash
   sudo service mongodb start
   # or
   mongod --fork --logpath /var/log/mongodb.log
   \`\`\`

5. Run the application:
   \`\`\`bash
   npm run dev
   \`\`\`

## Postman Setup Guide

1. **Import Collection**
   - Open Postman
   - Click "Import" button
   - Select \`E-commerce_Security_Demo.postman_collection.json\`

2. **Configure Environment**
   - Create a new environment
   - Add variables:
     - \`base_url\`: http://localhost:3000
     - \`vulnerable_token\`: (leave empty)
     - \`secure_token\`: (leave empty)

3. **Testing Workflow**

   A. **User Registration**
   1. Open "Register User" request
   2. Create customer account:
      \`\`\`json
      {
          "username": "customer1",
          "password": "password123",
          "role": "customer"
      }
      \`\`\`
   3. Create admin account:
      \`\`\`json
      {
          "username": "admin1",
          "password": "admin123",
          "role": "admin"
      }
      \`\`\`

   B. **Authentication Testing**
   1. Test Vulnerable Login:
      - Use "Login (Vulnerable)" request
      - Save token to \`vulnerable_token\` variable
   2. Test Secure Login:
      - Use "Login (Secure)" request
      - Save token to \`secure_token\` variable

   C. **BOLA Testing**
   1. Create Orders:
      - Login as customer1
      - Create order using "Create Order (Vulnerable)"
      - Note the order ID
   2. Access Control Test:
      - Login as customer2
      - Try accessing customer1's order using:
        - Vulnerable endpoint (will succeed)
        - Secure endpoint (will fail)

   D. **JWT Testing**
   1. Token Analysis:
      - Copy vulnerable token
      - Decode at jwt.io
      - Note the differences in claims
   2. Token Manipulation:
      - Modify token payload
      - Test with both endpoints

4. **Available Endpoints**

   A. **Authentication**
   - POST /api/auth/register
   - POST /api/auth/vulnerable/login
   - POST /api/auth/secure/login

   B. **Products**
   - GET /api/vulnerable/products
   - GET /api/secure/products
   - POST /api/vulnerable/products
   - POST /api/secure/products (admin only)
   - PUT /api/secure/products/:id (admin only)
   - POST /api/secure/products/:id/rate

   C. **Orders**
   - GET /api/vulnerable/orders
   - GET /api/secure/orders
   - POST /api/vulnerable/orders
   - POST /api/secure/orders
   - PUT /api/secure/orders/:id/status (admin only)

## Security Testing Scenarios

1. **JWT Vulnerability Testing**
   - Token expiration comparison
   - Token claim manipulation
   - Role modification attempts
   - Token replay attacks

2. **BOLA Vulnerability Testing**
   - Cross-user order access
   - Admin resource access
   - Direct object reference manipulation
   - Horizontal privilege escalation

3. **Authorization Testing**
   - Role-based access control
   - Resource ownership validation
   - Admin functionality access
   - User isolation verification

## Best Practices Demonstrated

1. **JWT Security**
   - Short-lived tokens
   - Strong secret keys
   - Comprehensive claims
   - Proper validation

2. **Authorization**
   - User ownership validation
   - Role-based access control
   - Resource isolation
   - Proper error handling

3. **API Security**
   - Input validation
   - Error handling
   - Secure defaults
   - Principle of least privilege 