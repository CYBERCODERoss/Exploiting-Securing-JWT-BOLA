I'll create a comprehensive scenario for an e-commerce website that demonstrates JWT and BOLA vulnerabilities, followed by their mitigation strategies.
E-commerce Security Vulnerability DemonstrationClick to open code
Let me break down the e-commerce scenario and its security vulnerabilities:
Scenario Overview
Imagine an e-commerce platform with the following components:

User authentication
Order management
Different user roles (customer, admin)

JWT (JSON Web Token) Vulnerabilities

Vulnerable Endpoint (/vulnerable/login):

Uses a weak, static secret key
Long token expiration (1 day)
Predictable token claims
Minimal token validation


Secure Endpoint (/secure/login):

Uses cryptographically secure random secret key
Short token expiration (30 minutes)
Added token identifier (UUID)
Includes issued-at and not-before timestamps



BOLA (Broken Object Level Authorization) Vulnerabilities

Vulnerable Order Retrieval (/vulnerable/orders):

No proper user authorization check
Allows accessing any order by manipulating order ID
Weak token validation


Secure Order Retrieval (/secure/orders):

Strict user ID and role validation
Prevents unauthorized access to orders
Comprehensive token validation



Potential Attack Scenarios

JWT Token Manipulation:

Attacker tries to decode and modify token claims
Extend token expiration
Change user role or user ID


BOLA Exploitation:

Access orders of other users
View sensitive order information
Potential data exposure



Mitigation Strategies Implemented

JWT Security:

Use of cryptographically secure random secret keys
Short-lived tokens
Unique token identifiers
Additional token claims (iat, nbf)


BOLA Prevention:

Strict user ID and role validation
Preventing cross-user data access
Comprehensive authorization checks



Testing Recommendations

Try accessing orders with:

Manipulated user IDs
Expired tokens
Tokens from different users


Attempt to:

Access admin resources with customer token
Forge tokens with modified claims
Bypass authorization checks



Additional Security Recommendations

Implement token refresh mechanism
Use HTTPS for all communications
Implement rate limiting
Add multi-factor authentication
Use secure password hashing (already demonstrated with bcrypt)
Log and monitor authentication attempts
Regularly rotate secret keys

Demonstration Steps

Login with different users
Try accessing orders with:

Same user token
Different user token
Admin token


Experiment with token manipulation